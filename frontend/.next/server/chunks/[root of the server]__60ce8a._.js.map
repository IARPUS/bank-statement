{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///Users/roychoi/Desktop/projects/bank-analysis/frontend/app/api/files/analyze/openAI/analysis/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\n\nexport const config = {\n  api: {\n    bodyParser: false,\n  },\n};\n\n/**\n * POST /api/process-tesseract\n *\n * Expects JSON body:\n * {\n *   \"text\": \"Extracted text from Tesseract\"\n * }\n */\nexport async function POST(req) {\n  console.log(\"API Route Hit\");\n  try {\n    // Parse the request body\n    const body = await req.json();\n\n    if (!body.text) {\n      return NextResponse.json(\n        { message: \"Missing 'text' in request body.\" },\n        { status: 400 }\n      );\n    }\n\n    // OpenAI API request\n    const openAIResponse = await fetch(\"https://api.openai.com/v1/chat/completions\", {\n      method: \"POST\",\n      headers: {\n        \"Authorization\": `Bearer ${process.env.OPENAI_API_KEY}`,\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        model: \"gpt-4\", // Change model to `gpt-4` or appropriate version\n        messages: [\n          {\n            role: \"user\",\n            content: `Given the following data ${body.text}, please provide your analysis and some speculations on the data in a json that follows the following structure:\n            {\n              \"Analysis Title 1\": {\n                \"Bullet 1\": \"some analysis\",\n                \"Bullet 2\": \"some analysis\",\n              },\n             \"Analysis Title 2\": {\n                \"Bullet 1\": \"some analysis\",\n                \"Bullet 2\": \"some analysis\",\n              },\n              \"Analysis Title 1\": {\n                \"Bullet 1\": \"some analysis\",\n                \"Bullet 2\": \"some analysis\",\n              },\n            }\n            `,\n          },\n        ],\n        temperature: 0.7,\n      }),\n    });\n\n    // Handle errors from OpenAI API\n    console.log(openAIResponse)\n    if (!openAIResponse.ok) {\n      const errorText = await openAIResponse.text();\n      return NextResponse.json(\n        { message: \"Failed to process text with OpenAI.\", error: errorText },\n        { status: openAIResponse.status }\n      );\n    }\n\n    // Parse and return the OpenAI response\n    const data = await openAIResponse.json();\n    const responseText = data.choices[0].message.content.trim();\n    console.log(responseText)\n    // Extract the JSON block\n    const jsonStartIndex = responseText.indexOf(\"{\");\n    const jsonEndIndex = responseText.lastIndexOf(\"}\");\n\n    if (jsonStartIndex === -1 || jsonEndIndex === -1) {\n      console.log(\"FAILED:\", responseText)\n      return NextResponse.json(\n        { message: \"Failed to extract JSON block from OpenAI response.\" },\n        { status: 500 }\n      );\n    }\n\n    const jsonString = responseText.substring(jsonStartIndex, jsonEndIndex + 1);\n\n    // Parse JSON block\n    let parsedJson;\n    try {\n      parsedJson = JSON.parse(jsonString);\n    } catch (error) {\n      return NextResponse.json(\n        { message: \"Failed to parse JSON from OpenAI response.\", error: error.message },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json(\n      { message: \"Text processed successfully.\", parsedData: parsedJson },\n      { status: 200 }\n    );\n  } catch (error) {\n    console.error(\"Error in proxy route:\", error);\n    return NextResponse.json(\n      { message: \"Unexpected error occurred.\", error: error.message },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,SAAS;IACpB,KAAK;QACH,YAAY;IACd;AACF;AAUO,eAAe,KAAK,GAAG;IAC5B,QAAQ,GAAG,CAAC;IACZ,IAAI;QACF,yBAAyB;QACzB,MAAM,OAAO,MAAM,IAAI,IAAI;QAE3B,IAAI,CAAC,KAAK,IAAI,EAAE;YACd,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAkC,GAC7C;gBAAE,QAAQ;YAAI;QAElB;QAEA,qBAAqB;QACrB,MAAM,iBAAiB,MAAM,MAAM,8CAA8C;YAC/E,QAAQ;YACR,SAAS;gBACP,iBAAiB,CAAC,OAAO,EAAE,QAAQ,GAAG,CAAC,cAAc,EAAE;gBACvD,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,OAAO;gBACP,UAAU;oBACR;wBACE,MAAM;wBACN,SAAS,CAAC,yBAAyB,EAAE,KAAK,IAAI,CAAC;;;;;;;;;;;;;;;YAe/C,CAAC;oBACH;iBACD;gBACD,aAAa;YACf;QACF;QAEA,gCAAgC;QAChC,QAAQ,GAAG,CAAC;QACZ,IAAI,CAAC,eAAe,EAAE,EAAE;YACtB,MAAM,YAAY,MAAM,eAAe,IAAI;YAC3C,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAuC,OAAO;YAAU,GACnE;gBAAE,QAAQ,eAAe,MAAM;YAAC;QAEpC;QAEA,uCAAuC;QACvC,MAAM,OAAO,MAAM,eAAe,IAAI;QACtC,MAAM,eAAe,KAAK,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI;QACzD,QAAQ,GAAG,CAAC;QACZ,yBAAyB;QACzB,MAAM,iBAAiB,aAAa,OAAO,CAAC;QAC5C,MAAM,eAAe,aAAa,WAAW,CAAC;QAE9C,IAAI,mBAAmB,CAAC,KAAK,iBAAiB,CAAC,GAAG;YAChD,QAAQ,GAAG,CAAC,WAAW;YACvB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAqD,GAChE;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,aAAa,aAAa,SAAS,CAAC,gBAAgB,eAAe;QAEzE,mBAAmB;QACnB,IAAI;QACJ,IAAI;YACF,aAAa,KAAK,KAAK,CAAC;QAC1B,EAAE,OAAO,OAAO;YACd,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAA8C,OAAO,MAAM,OAAO;YAAC,GAC9E;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAgC,YAAY;QAAW,GAClE;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAA8B,OAAO,MAAM,OAAO;QAAC,GAC9D;YAAE,QAAQ;QAAI;IAElB;AACF"}},
    {"offset": {"line": 166, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}